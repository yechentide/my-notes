# 符号化と伝送

## 音声の符号化

### アナログからデジタルに変換

- 情報落ち:連続量を離散量に変換する際に微細なデータが失われる
- デジタル化のメリット
    - ノイズに強い
    - データ量をコントロールできる
- MOS値
    - 通信品質を主観評価する代表的な方法
    - 人が聞いて、品質を５段階で評価する
- R値
    - 通信品質を客観評価する代表的な方法
    - ノイズ、エコー、遅延などの指標から、品質を100点満点で評価する
- IP電話の品質クラス: R値と遅延で３段階に分類する
    - A: R値が80超
    - B: R値が70超
    - C: R値が50超
- 変換の手順: 標本化 → 量子化 → 符号化

### 標本化 (サンプリング)

- 単位時間中の中央値や平均値によって標本値を決める
- 標本化ノイズ: 元のデータとの誤差
- サンプリング周波数: 縦に何本の線を入れるか
- 元のデータを復元するために、データに含まれる一番高い周波数の==２倍の周波数でサンプリング==を行う必要がある

### 量子化

- 標本値を整数化する
- 失われた情報を量子化ノイズという
- 量子化ビット数: 横に何本の線を入れるか

### 符号化

- 量子化した値を基にデジタルデータを作成
- 波形符号化: 原デーアの波形を忠実に再現する手法
    - PCM: サンプリング周波数✖️量子化ビット数=ビットレート(必要な回線容量)
    - ADPCM: PCMを改良してデータ容量を小さくしたもの
        - 前のデータとの差分で値を表現する
        - 急激なデータの変化に弱く、ノイズが生じることがある
- 分析合成符号化: 予めデータパテーンを用意し、原データに最も近いものを選ぶ手法
    - CELP: 携帯電話用に開発されたもの。パターン番号のみを送信する
    - ACELP
    - RCELP
    - MPEG-4 CELP

## 画像の符号化

### 圧縮手法

「エントロピ」とは平均情報量のことで、ある事象が起こりにくい場合に増加し、起こりやすい場合に減少する

- 予測符号化
    - 「隣接した点」「次の一瞬」は現在の点と同じであることがあるという予測も元
    - 現在のデータに対する差分でデータを表す
- 変換符号化 (直行変換)
    - 隣接する画素をペアにして直交座標にプロットしたあと、座標軸を回転させエントロピを小さい値に変換する
- 不可逆符号化
    - データ量を削減するため。人間が気づきにくい部分のデータを削減するなどの工夫がされている
- 動き補償予測
    - 動画で行われる予測手法
    - 動く物体が写っている画素をグループとして登録し、次の画像でその画素群がどこに移動しているかによって符号化する
- エントロピ符号化 (ハフマン符号化)
    - 出現頻度の高いデータに短い符号を与えることで、データ量を削減する手法

### 画像のデータ規格

- JPEG
    - ISOとITU-Tが組織した画像規格策定委員会の名称でもある
    - DCTとハフマン符号で圧縮しているので、高い圧縮率で写真を自然に復元できる
    - 不可逆変換なので、文字などににじみが生じることがある
- GIF
    - 可逆圧縮で文字やCGを綺麗に再現できる
    - 色数は256色までしか扱えない
    - LZWというアルゴリズムで圧縮している
- PNG
    - ==可逆圧縮で、フルカラーを扱える==

### 動画や音楽のデータ規格

- MPEG-1: ビットレートが 1.5 Mbps
    - CD-ROMなどのメディア向け
- MPEG-2: ビットレートが 数M〜数十M /s
    - ブルーレイなどの大容量メディアに保存したり、放送に用いることを想定した規格
- MPEG-4: ビットレートが 数十Kb /s
    - 通信速度の低い狭帯域回線でも利用できることを重視した規格
    - 携帯電話やテレビ電話など
- MPEG-7
    - マルチメディア情報の属性を記述するために開発されたもの
- MPEG-21
    - マルチメデイア情報の著作権管理を行うための標準規格
- MP3: MPEG-1の音声部分の圧縮方式を取り出したもの
- AAC: MP3の後継規格で、より高音質・高圧縮を実現した
- FLAC: 音質の劣化がない可逆圧縮形式のうち、特許等の縛りなく利用できるもの

## 符号化したデータの伝送

通信の同期とは、送受信側でタイミングを合わせること

### ビット同期 (クロック同期)

- 1ビットのデータを正しく認識する方法
- ビット位置を正しく認識するためにタイミングブロックを使う
- **連続同期方式**
    - データ信号の中に、同期タイミングをとるための信号を混在させる方式
- **調歩同期方式**: 非同期方式ともいう
    - 7ビットか8ビットの固定長ブロックの前後にビットを付加する方式
    - 1文字ごとに2ビットの情報を付加するので、大容量データの伝送には不向き
    - 送受信側で設定を合わせる必要がある: データブロックのサイズ、パリティの有無、伝送速度

### ブロック同期

- ビット同期が確立できたビット列を、ブロックとして認識するための同期方法
- **キャラクタ同期**
    - 送信時にまず==SYNコード(0b0001_0110)==を連続して送信する
    - 受信側がSYNコードを認識してから、データの受信を開始する
    - SYNコードのパターンをデータとして送れない
    - 8ビット長のデータしか送信できない
- **フラグ同期**
    - 送信したいデータの前後に==フラグ(0b0111_1110)==という特別なビット列を挿入して同期をとる
    - フラグと同じビット列がデータ中に出てくると、==ゼロインサーション==を行う
        - 1が５つ連続した場合、５つの1の後に強制的に0を１つ挿入する

## 回線制御

### 回線制御装置

- モデム: アナログ回線に対して接続・制御を行う回線制御装置
- RS-232C: シリアルインターフェイス規格
- NCU: モデムと交換機の間に入れる装置。ダイヤリングなどを行い回線を制御する

### 変調方式

- ASK (Amplitude Shift Keying, 振幅変調)
    - 振幅の大きさによって、0と1を判別する方式
    - 大きい音か小さい音か
- FSK (Frequency Shift Keying, 周波数変調)
    - 周波数の変化によって、0と1を判別する方式
    - 低い音か高い音か
- PSK (Phase Shift Keying, 位相変調)
    - 位相の変化によって、0と1を判別する方式

以上の変調方式を組み合わせてデータ通信を行う
- OFDM (直交周波数分割多元通信)
    - ASK + PSK
    - 周波数の異なる複数の搬送波を同時に送信できる

## トラフィック理論

- 呼: 通信機器に対する接続要求のこと。発呼と着呼がある
    - $$ 呼量 = \frac{呼数 × 平均回線保持時間}{単位時間} $$
- 再繁時呼数: 1日の中で最も呼数の多かった1時間における呼数
- 再繁時呼量: 再繁時呼数が得られたその1時間における呼量
- 呼損率: 発呼したけど着呼できないことが起こりうる確率

- アーラン: 呼量を表す単位。基本的に単位時間は１時間で考える
    - 電話機が1台, 10分間に2回の電話がかかってきた (それぞれ2分と4分)の場合
    - $$ 呼量 = \frac{2回 × 3分}{10分} = 0.6アーラン (単位時間が10分の場合) $$
- アーランの損失式数表
    - 呼損率を求めるには、アーランのB式を用いる
    - B式が複雑であるため、試験内では早見表で回答を導く (アーランの損失式数表)
    - 読み方は、まず横軸で欲しい呼損率を見つけ、その列で呼量を上まる最小限の回線数を確認する

## 待ち行列理論

- 待ち行列モデル: どのように待たされるかを計算するためのもの
- ケンドール記号: 待ち行列モデルを作成するためのデータを簡略化して表示するためのもの
    - `X / Y / S`
    - X: 到着分布
    - Y: サービス分布
    - S: 窓口数
    - 分布の種類
        - M: ポアソン分布または指数分布
        - G: 一般分布
        - D: 一定分布
- M/M/1モデル: 到着傾向がポアソン分布、サービス時間が指数分布、窓口が１つのモデル
    - 平均サービス時間は必ず設問で与えられる
    - $$ 平均応答時間 = 平均待ち時間 + 平均サービス時間 $$
    - $$ 平均待ち時間 = \frac{窓口利用率}{1 - 窓口利用率} \times 平均サービス時間 $$
    - $$ 窓口利用率 = \frac{平均到着率}{平均サービス量} $$
    - $$ 平均到着率 = \frac{1}{平均到着時間間隔} $$
    - $$ 平均サービス量 = \frac{1}{平均サービス時間} $$

## 誤り制御

- ARQ: 自動再送要求
- FEC: 誤り訂正
- jitter: アナログ通信が伝送中に歪み、デジタル変換するタイミングにズレが生じること
- 誤り検出により再送を行う方法: パリティチェック, CRC
- 誤り訂正により自己修復を行う方法: ハミング符号

### パリティチェック

- 最もシンプルな検査方法
- 7ビットデータを送信する場合、8ビット目に誤り検出用のパリティビットを付加する
- パリティビットの種類
    - 偶数パリティ: 8ビットデータの各ビットを足して偶数になるような、8ビット目のパリティビットのこと
    - 奇数パリティ: 8ビットデータの各ビットを足して奇数になるような、8ビット目のパリティビットのこと
- パリティチェックの種類
    - パリティビット込みの8ビットの列を縦にして、複数の列となる
    - ==垂直パリティ==: データ列ごとにパリティチェックを行う
    - ==水平パリティ==: 最後にBCCという冗長データ列を付加する
        - 各列の8ビット目は垂直パリティビット
        - 各行においてもパリティチェックを行い、BCC列を作る
    - ==群計数チェック方式==: 最後にCK1, CK2列を追加する
        - 水平方向の1のビット数を計算し、その結果を2進数に変えて、下2桁をCK1, CK2列に入れる
        - 偶数個ビットの誤りを検出できる

### CRC

生成多項式を利用して、誤り検出用の冗長データを添付する方式。バースト誤りも検出できる。  
バースト誤り: データが連続してエラーを起こす特性のこと

1. 送信データが`0110110`の場合
    $$ P(x) = x^5 + x^4 + x^2 + x^1 $$
2. 送受信ノード間で、生成多項式G(x)を決める
    $$ 例: G(x) = x^6 + x^2 + 1 $$
3. G(x)の最高次数を求める
    $$ x^6 $$
4. P(x)に最高次数をかけて、Q(x)を作る
    $$ Q(x) = x^11 + x^10 + x^8 + x^7 $$
5. Q(x)をG(x)で割って、誤りをR(x)とし、CRC符号とする (FCSとして送信)
    $$ R(x) = x^5 + 1, CRC = 0100001 $$
6. 受信ノードは検証を行う
    $$ \frac{P(x) \times x^6 - R(x)}{G(x)}の余りが0なら正常受信 $$

### ハミング符号

2ビットまでの誤り検出や、1ビットの誤り自動訂正機能を持っている
- 必要な検査ビット数
    - 4ビットの情報に3ビットの検査ビットを持たせる
    - 8ビットの情報に4ビットの検査ビットを持たせる
    - 16ビットの情報に5ビットの検査ビットを持たせる
- 検査の仕方
    - `0110`情報ビット列を`X1 X2 X3 X4`と表す
    - 検査ビットを`P1 P2 P3`と表す。分割したデータと検査ビットの==XOR演算が0になる==ように、検査ビットを決める
        - `X1    X3 X4   P1` = `0   1 0   1`
        - `X1 X2    X4   P2` = `0 1   0   1`
        - `X1 X2 X3      P3` = `0 1 1     0`
    - 送信するハミング符号: `X1 X2 X3 P1 X4 P2 P3` = `0110011`
